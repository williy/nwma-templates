# NWMA 実装事例：自宅検証環境における K3s クラスター構築

20年超のインフラ設計経験に基づき、独自の設計フレームワーク **NWMA** を用いて、Ubuntu 環境への Kubernetes (K3s) 構築を体系化した事例です。

---

## A. 要件定義 (Requirement Sheet)
設計の「背骨」となる判断基準を定義します。

| No | 項目名 | 設計上の意味 | 記載内容 | 設計判断メモ |
|:---|:---|:---|:---|:---|
| 1 | システム名称 | 識別 | 自宅検証用 K8s 基盤 | 試行錯誤のログをNWMAで管理 |
| 9 | 利用目的 | 設計思想の軸 | K8s 運用スキルの習得 | 複雑さを排し、本質の理解に注力 |
| 10 | 業務影響度 | 可用性基準 | 低（個人開発用） | 停止を許容し、リソース効率を優先 |
| 13 | 性能要件 | リソース選定 | 軽量動作（K3s を採用） | **フルスタック K8s 構築でのリソース競合（失敗）**を鑑み、軽量版を選択 |

## B. 構造設計 (Architecture Sheet)
要件(A)に基づき、具体的な論理構造を決定します。

| 項目 | 設定値 | 設計根拠 (A-No) | 設計判断理由 |
|:---|:---|:---|:---|
| Distribution | **K3s (v1.2x)** | A-10, A-13 | 低リソース環境での安定稼働を優先 |
| Network | Flannel (VXLAN) | A-9 | 標準的かつトラブルシューティングが容易な構成 |
| IP Range | 192.168.x.x/24 | A-14 | 既存の自宅検証LANとの整合性維持 |

## C. 検証・試験 (Verification Sheet)
構造(B)が要件(A)を満たしているかを客観的に証明します。

| カテゴリ | 試験項目 | 連動要件 (A/B) | 試験の目的 | 合格基準 |
|:---|:---|:---|:---|:---|
| 起動確認 | Node Ready 試験 | B-1 | K3s サービスが正常に稼働しているか | `kubectl get nodes` で Ready となること |
| 疎通性 | Pod 間通信確認 | A-9, B-2 | CNI (Flannel) が正常機能しているか | 異なる Pod 間で ICMP 応答があること |
| 負荷耐性 | メモリ消費量確認 | A-13 | OS フリーズが発生しないか | アイドル時メモリ使用率が 50% 以下を維持 |

---

## 設計者メモ：今回の「失敗」からの学び
フルスタックな Kubernetes 構築を当初試みましたが、リソース不足によるコンポーネントのクラッシュに直面しました。
NWMA に基づき「A-13：性能要件（軽量動作）」を再定義し、**K3s へのシフト**という設計判断を B シートに反映させた結果、安定した検証環境の構築に成功しました。